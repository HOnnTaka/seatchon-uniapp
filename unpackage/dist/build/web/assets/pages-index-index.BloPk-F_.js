import{g as e,r as t,o as a,c as o,w as l,n as i,a as s,b as n,d as r,e as c,F as u,f as h,h as d,t as f,i as m,j as p,k as b,l as _,m as g,p as y,I as v,q as w,s as x,u as C,v as k,x as S,y as B,z as T,S as $,A as V,B as z,C as D}from"./index-ToqSIm9Z.js";import{_ as F,r as P,a as I,o as j,b as R,c as A,d as M,e as N}from"./uni-card.DqZYxwyK.js";import{_ as E}from"./uni-list-item.DWC9pjVq.js";import{_ as W,a as H}from"./unicloud-db.D62kBxQL.js";import{_ as U}from"./uni-load-more.d8wG-qTT.js";const O=F({name:"UniFab",emits:["fabClick","trigger"],props:{pattern:{type:Object,default:()=>({})},horizontal:{type:String,default:"left"},vertical:{type:String,default:"bottom"},direction:{type:String,default:"horizontal"},content:{type:Array,default:()=>[]},show:{type:Boolean,default:!1},popMenu:{type:Boolean,default:!0}},data:()=>({fabShow:!1,isShow:!1,isAndroidNvue:!1,styles:{color:"#3c3e49",selectedColor:"#007AFF",backgroundColor:"#fff",buttonColor:"#007AFF",iconColor:"#fff",icon:"plusempty"}}),computed:{contentWidth(e){return 55*(this.content.length+1)+15+"px"},contentWidthMin:()=>"55px",boxWidth(){return this.getPosition(3,"horizontal")},boxHeight(){return this.getPosition(3,"vertical")},leftBottom(){return this.getPosition(0,"left","bottom")},rightBottom(){return this.getPosition(0,"right","bottom")},leftTop(){return this.getPosition(0,"left","top")},rightTop(){return this.getPosition(0,"right","top")},flexDirectionStart(){return this.getPosition(1,"vertical","top")},flexDirectionEnd(){return this.getPosition(1,"vertical","bottom")},horizontalLeft(){return this.getPosition(2,"horizontal","left")},horizontalRight(){return this.getPosition(2,"horizontal","right")},nvueBottom:()=>(e().windowBottom,30)},watch:{pattern:{handler(e,t){this.styles=Object.assign({},this.styles,e)},deep:!0}},created(){this.isShow=this.show,0===this.top&&(this.fabShow=!0),this.styles=Object.assign({},this.styles,this.pattern)},methods:{_onClick(){this.$emit("fabClick"),this.popMenu&&(this.isShow=!this.isShow)},open(){this.isShow=!0},close(){this.isShow=!1},_onItemClick(e,t){this.isShow&&this.$emit("trigger",{index:e,item:t})},getPosition(e,t,a){return 0===e?this.horizontal===t&&this.vertical===a:1===e?this.direction===t&&this.vertical===a:2===e?this.direction===t&&this.horizontal===a:this.isShow&&this.direction===t?this.contentWidth:this.contentWidthMin}}},[["render",function(e,_,g,y,v,w){const x=m,C=p,k=b,S=P(t("uni-icons"),I);return a(),o(x,{class:"uni-cursor-point"},{default:l((()=>[g.popMenu&&(w.leftBottom||w.rightBottom||w.leftTop||w.rightTop)&&g.content.length>0?(a(),o(x,{key:0,class:i([{"uni-fab--leftBottom":w.leftBottom,"uni-fab--rightBottom":w.rightBottom,"uni-fab--leftTop":w.leftTop,"uni-fab--rightTop":w.rightTop},"uni-fab"]),style:s(w.nvueBottom)},{default:l((()=>[n(x,{class:i([{"uni-fab__content--left":"left"===g.horizontal,"uni-fab__content--right":"right"===g.horizontal,"uni-fab__content--flexDirection":"vertical"===g.direction,"uni-fab__content--flexDirectionStart":w.flexDirectionStart,"uni-fab__content--flexDirectionEnd":w.flexDirectionEnd,"uni-fab__content--other-platform":!v.isAndroidNvue},"uni-fab__content"]),style:s({width:w.boxWidth,height:w.boxHeight,backgroundColor:v.styles.backgroundColor}),elevation:"5"},{default:l((()=>[w.flexDirectionStart||w.horizontalLeft?(a(),o(x,{key:0,class:"uni-fab__item uni-fab__item--first"})):r("",!0),(a(!0),c(u,null,h(g.content,((e,t)=>(a(),o(x,{key:t,class:i([{"uni-fab__item--active":v.isShow},"uni-fab__item"]),onClick:a=>w._onItemClick(t,e)},{default:l((()=>[n(C,{src:e.active?e.selectedIconPath:e.iconPath,class:"uni-fab__item-image",mode:"aspectFit"},null,8,["src"]),n(k,{class:"uni-fab__item-text",style:s({color:e.active?v.styles.selectedColor:v.styles.color})},{default:l((()=>[d(f(e.text),1)])),_:2},1032,["style"])])),_:2},1032,["class","onClick"])))),128)),w.flexDirectionEnd||w.horizontalRight?(a(),o(x,{key:1,class:"uni-fab__item uni-fab__item--first"})):r("",!0)])),_:1},8,["class","style"])])),_:1},8,["class","style"])):r("",!0),n(x,{class:i([{"uni-fab__circle--leftBottom":w.leftBottom,"uni-fab__circle--rightBottom":w.rightBottom,"uni-fab__circle--leftTop":w.leftTop,"uni-fab__circle--rightTop":w.rightTop,"uni-fab__content--other-platform":!v.isAndroidNvue},"uni-fab__circle uni-fab__plus"]),style:s({"background-color":v.styles.buttonColor,bottom:w.nvueBottom}),onClick:w._onClick},{default:l((()=>[n(S,{class:i(["fab-circle-icon",{"uni-fab__plus--active":v.isShow&&g.content.length>0}]),type:v.styles.icon,color:v.styles.iconColor,size:"32"},null,8,["type","color","class"])])),_:1},8,["class","style","onClick"])])),_:1})}],["__scopeId","data-v-b7eca566"]]),L={en:{"uni-search-bar.cancel":"cancel","uni-search-bar.placeholder":"Search enter content"},"zh-Hans":{"uni-search-bar.cancel":"取消","uni-search-bar.placeholder":"请输入搜索内容"},"zh-Hant":{"uni-search-bar.cancel":"取消","uni-search-bar.placeholder":"請輸入搜索內容"}},{t:q}=_(L);const G=F({name:"UniSearchBar",emits:["input","update:modelValue","clear","cancel","confirm","blur","focus"],props:{placeholder:{type:String,default:""},radius:{type:[Number,String],default:5},clearButton:{type:String,default:"auto"},cancelButton:{type:String,default:"auto"},cancelText:{type:String,default:""},bgColor:{type:String,default:"#F8F8F8"},textColor:{type:String,default:"#000000"},maxlength:{type:[Number,String],default:100},value:{type:[Number,String],default:""},modelValue:{type:[Number,String],default:""},focus:{type:Boolean,default:!1},readonly:{type:Boolean,default:!1}},data:()=>({show:!1,showSync:!1,searchVal:""}),computed:{cancelTextI18n(){return this.cancelText||q("uni-search-bar.cancel")},placeholderText(){return this.placeholder||q("uni-search-bar.placeholder")}},watch:{modelValue:{immediate:!0,handler(e){this.searchVal=e,e&&(this.show=!0)}},focus:{immediate:!0,handler(e){if(e){if(this.readonly)return;this.show=!0,this.$nextTick((()=>{this.showSync=!0}))}}},searchVal(e,t){this.$emit("input",e),this.$emit("update:modelValue",e)}},methods:{searchClick(){this.readonly||this.show||(this.show=!0,this.$nextTick((()=>{this.showSync=!0})))},clear(){this.searchVal="",this.$nextTick((()=>{this.$emit("clear",{value:""})}))},cancel(){this.readonly||(this.$emit("cancel",{value:this.searchVal}),this.searchVal="",this.show=!1,this.showSync=!1,g())},confirm(){g(),this.$emit("confirm",{value:this.searchVal})},blur(){g(),this.$emit("blur",{value:this.searchVal})},emitFocus(e){this.$emit("focus",e.detail)}}},[["render",function(e,i,c,u,h,p){const _=P(t("uni-icons"),I),g=m,w=v,x=b;return a(),o(g,{class:"uni-searchbar"},{default:l((()=>[n(g,{style:s({borderRadius:c.radius+"px",backgroundColor:c.bgColor}),class:"uni-searchbar__box",onClick:p.searchClick},{default:l((()=>[n(g,{class:"uni-searchbar__box-icon-search"},{default:l((()=>[y(e.$slots,"searchIcon",{},(()=>[n(_,{color:"#c0c4cc",size:"18",type:"search"})]),!0)])),_:3}),h.show||h.searchVal?(a(),o(w,{key:0,focus:h.showSync,disabled:c.readonly,placeholder:p.placeholderText,maxlength:c.maxlength,class:"uni-searchbar__box-search-input","confirm-type":"search",type:"text",modelValue:h.searchVal,"onUpdate:modelValue":i[0]||(i[0]=e=>h.searchVal=e),style:s({color:c.textColor}),onConfirm:p.confirm,onBlur:p.blur,onFocus:p.emitFocus},null,8,["focus","disabled","placeholder","maxlength","modelValue","style","onConfirm","onBlur","onFocus"])):(a(),o(x,{key:1,class:"uni-searchbar__text-placeholder"},{default:l((()=>[d(f(c.placeholder),1)])),_:1})),h.show&&("always"===c.clearButton||"auto"===c.clearButton&&""!==h.searchVal)&&!c.readonly?(a(),o(g,{key:2,class:"uni-searchbar__box-icon-clear",onClick:p.clear},{default:l((()=>[y(e.$slots,"clearIcon",{},(()=>[n(_,{color:"#c0c4cc",size:"20",type:"clear"})]),!0)])),_:3},8,["onClick"])):r("",!0)])),_:3},8,["style","onClick"]),"always"===c.cancelButton||h.show&&"auto"===c.cancelButton?(a(),o(x,{key:0,onClick:p.cancel,class:"uni-searchbar__cancel"},{default:l((()=>[d(f(p.cancelTextI18n),1)])),_:1},8,["onClick"])):r("",!0)])),_:3})}],["__scopeId","data-v-314f636a"]]),J=F({__name:"index",setup(e){const p=w().find((e=>"pages/index/index"===e.route)),_=x("");x([]),x({});const g=x({}),y=x(!1),v=x(!1),F=x("");j((async()=>{})),R((async()=>{C(),setTimeout((()=>{y.value=!0}),100)})),A((async()=>{y.value=!1}));const I=async()=>{var e;v.value=!0,g.value=k("userinfo"),await(null==(e=p.$vm.$refs.udb)?void 0:e.loadData({clear:!0})),setTimeout((()=>{S(),v.value=!1,B()}))},L=async e=>{console.log(e),await p.$vm.$refs.udb.loadMore(),B()};M(I);const q=e=>e.join(" 至 "),J=e=>{const t=(new Date).getTime(),a=[new Date(e[0]).getTime(),new Date(e[1]).getTime()];return t<a[0]||t>a[1]},K=async()=>{const e=_.value.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");console.log(e),F.value=`${new RegExp(e,"i")}.test(title) || ${new RegExp(e,"i")}.test(note)`,setTimeout((async()=>{var e;await(null==(e=p.$vm.$refs.udb)?void 0:e.loadData({clear:!0}))}))},Q=async()=>{F.value="",setTimeout((async()=>{var e;await(null==(e=p.$vm.$refs.udb)?void 0:e.loadData({clear:!0}))}))},X=()=>{T({url:"/pages/createSeatChart/createSeatChart"})};return(e,p)=>{const w=P(t("uni-fab"),O),x=P(t("uni-search-bar"),G),C=m,k=b,S=P(t("uni-list-item"),E),B=P(t("uni-list"),W),j=P(t("uni-load-more"),U),R=P(t("unicloud-db"),H),A=$,M=P(t("uni-card"),N);return a(),o(C,{class:"container",style:s([{transition:"all 1s ease",opacity:"0"},y.value?"transition: all .5s ease; opacity: 1":""])},{default:l((()=>[1==g.value.type?(a(),o(w,{key:0,ref:"fab",pattern:{buttonColor:"#2979ff"},horizontal:"right",vertical:"bottom",onFabClick:X},null,512)):r("",!0),n(C,{class:"search-bar"},{default:l((()=>[n(x,{bgColor:"#fff",onConfirm:K,onCancel:Q,radius:"5",modelValue:_.value,"onUpdate:modelValue":p[0]||(p[0]=e=>_.value=e),placeholder:"请输入搜索内容"},null,8,["modelValue"])])),_:1}),n(M,{padding:"0"},{default:l((()=>[n(A,{class:"DBscrollBox","scroll-y":"","refresher-enabled":"","enable-back-to-top":"","scroll-with-animation":"","refresher-triggered":v.value,onScrolltolower:L,onRefresherrefresh:I},{default:l((()=>[n(R,{ref:"udb",collection:"seat-chart","page-size":10,orderby:"title desc",where:F.value,class:"DBBox"},{default:l((({data:e,loading:t,hasMore:s,error:m,options:p})=>[m?(a(),o(C,{key:0,class:"error"},{default:l((()=>[d(f(console.log(m.message))+"获取列表失败,下拉刷新试试？",1)])),_:2},1024)):r("",!0),n(B,{showArrow:""},{default:l((()=>[(a(!0),c(u,null,h(e,((e,t)=>(a(),o(S,{key:e._id,clickable:"",showArrow:"",onClick:t=>(async e=>{g.value?(D({title:"加载中"}),T({url:`/pages/detail/detail?chartId=${e._id}`})):(await V({title:"提示",content:"还未登录，是否前往登录？",showCancel:!0,confirmText:"前往登录"})).confirm&&z({url:"/pages/user/user"})})(e),title:e.title,note:e.note,class:"list-item"},{header:l((()=>[n(C,{class:"item-header"})])),body:l((()=>[n(C,{class:"item-body"},{default:l((()=>[n(C,{class:"item-content"},{default:l((()=>[n(k,{"user-select":"",class:"item-title"},{default:l((()=>[d(f(e.title),1)])),_:2},1024),n(k,{"user-select":"",class:"item-note"},{default:l((()=>[d(f(e.note),1)])),_:2},1024)])),_:2},1024),n(C,{class:"item-time"},{default:l((()=>[n(k,null,{default:l((()=>[d("选座："+f(q(e.selectableTimeRange)),1)])),_:2},1024),n(k,null,{default:l((()=>[d("生效："+f(q(e.effectiveTimeRange)),1)])),_:2},1024)])),_:2},1024)])),_:2},1024)])),footer:l((()=>[n(C,{class:"item-footer"},{default:l((()=>[n(C,{class:i(["tag-item",{disable:J(e.selectableTimeRange)}])},{default:l((()=>[d("选")])),_:2},1032,["class"]),n(C,{class:i(["tag-item",{disable:J(e.effectiveTimeRange)}])},{default:l((()=>[d("效")])),_:2},1032,["class"])])),_:2},1024)])),_:2},1032,["onClick","title","note"])))),128))])),_:2},1024),n(j,{status:t?"loading":s?"more":"no-more"},null,8,["status"])])),_:1},8,["where"])])),_:1},8,["refresher-triggered"])])),_:1})])),_:1},8,["style"])}}},[["__scopeId","data-v-4cc94e0e"]]);export{J as default};
