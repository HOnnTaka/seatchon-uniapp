"use strict";const e=require("../../common/vendor.js");if(!Array){(e.resolveComponent("uni-easyinput")+e.resolveComponent("uni-forms-item")+e.resolveComponent("uni-number-box")+e.resolveComponent("uni-datetime-picker")+e.resolveComponent("uni-data-checkbox")+e.resolveComponent("uni-group")+e.resolveComponent("uni-forms"))()}Math||((()=>"../../uni_modules/uni-easyinput/components/uni-easyinput/uni-easyinput.js")+(()=>"../../uni_modules/uni-forms/components/uni-forms-item/uni-forms-item.js")+(()=>"../../uni_modules/uni-number-box/components/uni-number-box/uni-number-box.js")+(()=>"../../uni_modules/uni-datetime-picker/components/uni-datetime-picker/uni-datetime-picker.js")+(()=>"../../uni_modules/uni-data-checkbox/components/uni-data-checkbox/uni-data-checkbox.js")+(()=>"../../uni_modules/uni-group/components/uni-group/uni-group.js")+(()=>"../../uni_modules/uni-forms/components/uni-forms/uni-forms.js"))();const o={__name:"createSeatChart",setup(o){e.onLoad((async()=>{})),f;const r=(new Date).toJSON().substring(0,10),t=e.reactive({title:"",note:"",col:"10",row:"11",stuInfoVisible:0,effectiveTimeRange:[],selectableTimeRange:[]}),a=e.ref(!1),n=e.ref([]),i=e.computed((()=>{const e=parseInt(t.col),o=parseInt(t.row);a.value=!0;let r=[];n.value=[];for(let t=0;t<o;t++)for(let o=0;o<e;o++)r.push({x:o+1,y:t+1}),n.value.push(1);return a.value=!1,r})),l=e.ref([{text:"允许",value:0},{text:"不允许",value:1}]),s={title:{rules:[{required:!0,errorMessage:"请输入标题"}]},col:{rules:[{required:!0,errorMessage:"请输入列数"},{format:"number",errorMessage:"请输入正确的数字"}]},row:{rules:[{required:!0,errorMessage:"请输入行数"},{format:"number",errorMessage:"请输入正确的数字"}]},selectableTimeRange:{rules:[{required:!0,errorMessage:"请选择开放选择时间"},{type:"array",errorMessage:"请选择开放选择时间"}]},effectiveTimeRange:{rules:[{required:!0,errorMessage:"请选择座位有效时间"},{type:"array",errorMessage:"请选择座位有效时间"}]}};return(o,u)=>({a:e.o((e=>t.title=e)),b:e.p({trim:"both",placeholder:"请输入标题",modelValue:t.title}),c:e.p({label:"标题（课室）",required:!0,name:"title"}),d:e.o((e=>t.note=e)),e:e.p({trim:"true",placeholder:"请输入备注",modelValue:t.note}),f:e.p({label:"备注",name:"note"}),g:e.o((e=>t.row=e)),h:e.p({modelValue:t.row}),i:e.p({label:"行",required:!0,name:"row"}),j:e.o((e=>t.col=e)),k:e.p({modelValue:t.col}),l:e.p({label:"列",required:!0,name:"col"}),m:e.o((e=>t.selectableTimeRange=e)),n:e.p({start:e.unref(r),"start-placeholder":e.unref(r),type:"daterange",rangeSeparator:"至",modelValue:t.selectableTimeRange}),o:e.p({required:!0,label:"开放选择时间",name:"selectableTimeRange"}),p:e.o((e=>t.effectiveTimeRange=e)),q:e.p({"start-placeholder":e.unref(r),start:e.unref(r),type:"daterange",rangeSeparator:"至",modelValue:t.effectiveTimeRange}),r:e.p({required:!0,label:"座位有效时间",name:"effectiveTimeRange"}),s:e.o((e=>t.stuInfoVisible=e)),t:e.p({localdata:l.value,modelValue:t.stuInfoVisible}),v:e.p({label:"是否允许查看其它学生信息",required:!0,name:"stuInfoVisible"}),w:e.p({title:"课室信息",mode:"card"}),x:e.f(i.value,((o,r,t)=>({a:r,b:1==n.value[r]?1:"",c:e.o((()=>n.value[r]=1==n.value[r]?2:1),r)}))),y:e.s(`--col:${t.col};--row:${t.row};`),z:e.p({title:"座位表",mode:"card"}),A:e.o((()=>(async o=>{const r=getCurrentPages()[1].$vm;try{const l=await r.$refs[o].validate();if(console.log(l),(await e.index.showModal({title:"提示",content:"将创建新座位表"+t.title,showCancel:!0})).confirm){a.value=!0;const o=e.index.getStorageSync("userinfo"),r=e.Ws.database(),t=await r.collection("seat-chart").add({...l,stuInfoVisible:0==l.stuInfoVisible,createTime:(new Date).toJSON(),creator:o.nickName,creatorId:o._openid,seats:i.value.map(((e,o)=>({x:e.x,y:e.y,status:n.value[o],index:o+1})))});console.log(t),0==t.result.errCode&&(e.index.showToast({title:"创建成功",icon:"none"}),setTimeout((()=>{e.index.navigateBack()}),1e3))}}catch(l){console.log(l),e.index.showToast({title:l[0].errorMessage,icon:"none"})}})("valiForm"))),B:e.sr("valiForm","05355019-0"),C:e.p({"label-width":"100%",modelValue:t,"label-position":"top",rules:s})})}};wx.createPage(o);
