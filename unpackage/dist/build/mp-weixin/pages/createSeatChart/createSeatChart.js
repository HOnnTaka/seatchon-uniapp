"use strict";const e=require("../../common/vendor.js");if(!Array){(e.resolveComponent("uni-section")+e.resolveComponent("uni-easyinput")+e.resolveComponent("uni-forms-item")+e.resolveComponent("uni-number-box")+e.resolveComponent("uni-datetime-picker")+e.resolveComponent("uni-data-checkbox")+e.resolveComponent("uni-card")+e.resolveComponent("uni-forms"))()}Math||((()=>"../../uni_modules/uni-section/components/uni-section/uni-section.js")+(()=>"../../uni_modules/uni-easyinput/components/uni-easyinput/uni-easyinput.js")+(()=>"../../uni_modules/uni-forms/components/uni-forms-item/uni-forms-item.js")+(()=>"../../uni_modules/uni-number-box/components/uni-number-box/uni-number-box.js")+(()=>"../../uni_modules/uni-datetime-picker/components/uni-datetime-picker/uni-datetime-picker.js")+(()=>"../../uni_modules/uni-data-checkbox/components/uni-data-checkbox/uni-data-checkbox.js")+(()=>"../../uni_modules/uni-card/components/uni-card/uni-card.js")+(()=>"../../uni_modules/uni-forms/components/uni-forms/uni-forms.js"))();const o={__name:"createSeatChart",setup(o){e.onLoad((async()=>{}));const n=(new Date).toJSON().substring(0,10),t=e.reactive({title:"",note:"",col:"10",row:"11",stuInfoVisible:0,effectiveTimeRange:[],selectableTimeRange:[]}),r=e.ref(!1),a=e.ref([]),i=e.computed((()=>{const e=parseInt(t.col),o=parseInt(t.row);r.value=!0;let n=[];a.value=[];for(let t=0;t<o;t++)for(let o=0;o<e;o++)n.push({x:o+1,y:t+1}),a.value.push(1);return r.value=!1,n})),s=e.ref([{text:"允许",value:0},{text:"不允许",value:1}]),l={title:{rules:[{required:!0,errorMessage:"请输入标题"}]},col:{rules:[{required:!0,errorMessage:"请输入列数"},{format:"number",errorMessage:"请输入正确的数字"}]},row:{rules:[{required:!0,errorMessage:"请输入行数"},{format:"number",errorMessage:"请输入正确的数字"}]},selectableTimeRange:{rules:[{required:!0,errorMessage:"请选择开放选择时间"},{type:"array",errorMessage:"请选择开放选择时间"}]},effectiveTimeRange:{rules:[{required:!0,errorMessage:"请选择座位有效时间"},{type:"array",errorMessage:"请选择座位有效时间"}]}};return(o,u)=>({a:e.p({title:"课室信息",type:"line"}),b:e.o((e=>t.title=e)),c:e.p({trim:"both",placeholder:"请输入标题",modelValue:t.title}),d:e.p({label:"标题（课室）",required:!0,name:"title"}),e:e.o((e=>t.note=e)),f:e.p({trim:"true",placeholder:"请输入备注",modelValue:t.note}),g:e.p({label:"备注",name:"note"}),h:e.o((e=>t.row=e)),i:e.p({modelValue:t.row}),j:e.p({label:"行",required:!0,name:"row"}),k:e.o((e=>t.col=e)),l:e.p({modelValue:t.col}),m:e.p({label:"列",required:!0,name:"col"}),n:e.o((e=>t.selectableTimeRange=e)),o:e.p({start:e.unref(n),"start-placeholder":e.unref(n),type:"daterange",rangeSeparator:"至",modelValue:t.selectableTimeRange}),p:e.p({required:!0,label:"开放选择时间",name:"selectableTimeRange"}),q:e.o((e=>t.effectiveTimeRange=e)),r:e.p({"start-placeholder":e.unref(n),start:e.unref(n),type:"daterange",rangeSeparator:"至",modelValue:t.effectiveTimeRange}),s:e.p({required:!0,label:"座位有效时间",name:"effectiveTimeRange"}),t:e.o((e=>t.stuInfoVisible=e)),v:e.p({localdata:s.value,modelValue:t.stuInfoVisible}),w:e.p({label:"是否允许查看其它学生信息",required:!0,name:"stuInfoVisible"}),x:e.p({padding:"0"}),y:e.p({title:"座位表",type:"line"}),z:e.f(i.value,((o,n,t)=>({a:n,b:1==a.value[n]?1:"",c:e.o((()=>a.value[n]=1==a.value[n]?2:1),n)}))),A:e.s(`--col:${t.col};--row:${t.row};`),B:e.p({padding:"0"}),C:e.o((()=>(async o=>{const n=getCurrentPages()[1].$vm;try{const s=await n.$refs[o].validate();if(console.log(s),(await e.index.showModal({title:"提示",content:"将创建新座位表"+t.title,showCancel:!0})).confirm){e.index.showLoading({title:"创建中"}),r.value=!0;const o=e.index.getStorageSync("userinfo"),n=e.Ws.database(),t=await n.collection("seat-chart").add({...s,stuInfoVisible:0==s.stuInfoVisible,createTime:(new Date).toJSON(),creator:o.nickName,creatorId:o._id,administrators:[o._id],seats:i.value.map(((e,o)=>({x:e.x,y:e.y,status:a.value[o],index:o+1})))});console.log(t),0==t.result.errCode&&(e.index.showToast({title:"创建成功",icon:"success"}),setTimeout((()=>{e.index.navigateBack()}),1e3)),e.index.hideLoading(),r.value=!1}}catch(s){console.log(s),e.index.showToast({title:s[0].errorMessage,icon:"none"})}})("valiForm"))),D:e.sr("valiForm","05355019-0"),E:e.p({"label-width":"100%",modelValue:t,"label-position":"top",rules:l})})}};wx.createPage(o);
