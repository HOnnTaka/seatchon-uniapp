"use strict";const e=require("../../common/vendor.js");if(!Array){(e.resolveComponent("uni-section")+e.resolveComponent("uni-list-item")+e.resolveComponent("uni-collapse-item")+e.resolveComponent("uni-collapse")+e.resolveComponent("uni-card")+e.resolveComponent("uni-dateformat"))()}Math||((()=>"../../uni_modules/uni-section/components/uni-section/uni-section.js")+(()=>"../../uni_modules/uni-list/components/uni-list-item/uni-list-item.js")+(()=>"../../uni_modules/uni-collapse/components/uni-collapse-item/uni-collapse-item.js")+(()=>"../../uni_modules/uni-collapse/components/uni-collapse/uni-collapse.js")+(()=>"../../uni_modules/uni-card/components/uni-card/uni-card.js")+(()=>"../../uni_modules/uni-dateformat/components/uni-dateformat/uni-dateformat.js"))();const l={__name:"detail",setup(l){const a=e.ref(null),t=e.ref(null),i=e.ref(),n=e.ref(!1),u=e.ref(e.index.getStorageSync("userinfo")),o=e.ref(!1),s=e.ref(!0),v=e.ref(!1);e.onLoad((async l=>{t.value=l.chartId,await d(l.chartId),v.value=!0,e.index.hideLoading()})),e.onShow((async()=>{u.value=e.index.getStorageSync("userinfo")})),e.onReady((()=>{})),e.onPullDownRefresh((async()=>{await d(t.value),e.index.stopPullDownRefresh(),e.index.showToast({title:"刷新成功",icon:"success"})}));const d=async l=>{n.value=!0;const a=e.Ws.database(),{result:t}=await a.collection("seat-chart").doc(l).get();i.value=t.data[0],console.log(t.data[0]),e.index.setNavigationBarTitle({title:i.value.title}),await c(),n.value=!1},r=e.ref(""),c=async()=>{var l;if(!(null==(l=i.value)?void 0:l.administrators))return"";const a=e.Ws.database(),{result:t}=await a.collection("user").where({_id:a.command.in(i.value.administrators)}).field("nickName").get();console.log(t.data,i.value.administrators),r.value=t.data.map((e=>e.nickName)).join("、")},p=()=>{var e;if(!i.value)return!1;const l=null==(e=i.value)?void 0:e.selectableTimeRange,a=(new Date).getTime(),t=new Date(l[0]).getTime(),n=new Date(l[1]).getTime();return t<=a&&a<=n},m=async(l=!0)=>{var n;await d(t.value),l&&e.index.showToast({title:"刷新成功",icon:"success"}),a.value=i.value.seats[(null==(n=a.value)?void 0:n.index)-1]},f=async()=>{var e;u.value,s.value=(null==(e=a.value.stuInfo)?void 0:e.id)!=u.value._id,o.value=!0},g=async()=>{e.index.showLoading({title:"加载中",mask:!0});const{result:l}=await e.Ws.callFunction({name:"select-seat",data:{chartId:t.value,seatIndex:a.value.index,userinfo:u.value,isSelectSubmit:s.value,orderId:a.value.orderId}});o.value=!1,200==l.code?e.index.showToast({title:"选座成功",icon:"success"}):201==l.code?e.index.showToast({title:"撤销成功",icon:"success"}):e.index.showToast({title:l.message,icon:"error"}),m(!1)},y=async()=>{console.log("addadmin")};return(l,t)=>{var v,d,c,w,I,_,h,x,T,j,b,k,R,S,C,D,L,N,P,W,B,M,V,$,q,A,F,z,E,G,H,J,K,O,Q;return e.e({a:null==(v=i.value)?void 0:v.administrators.includes(u.value._id)},(null==(d=i.value)||d.administrators.includes(u.value._id),{}),{b:e.p({title:"课室信息",type:"line"}),c:e.t(null==(c=i.value)?void 0:c.title),d:e.p({title:"课室"}),e:e.t(null==(w=i.value)?void 0:w.note),f:e.p({title:"备注"}),g:e.t(r.value),h:e.o(y),i:e.p({title:"管理员",link:null==(I=i.value)?void 0:I.administrators.includes(u.value._id)}),j:e.t(null==(_=i.value)?void 0:_.selectableTimeRange.join(" 至 ")),k:e.p({title:"选座时间"}),l:e.t(null==(h=i.value)?void 0:h.effectiveTimeRange.join(" 至 ")),m:e.p({title:"生效时间"}),n:e.p({open:!0,titleBorder:"none"}),o:e.p({padding:"0"}),p:e.p({title:"座位表",type:"line"}),q:e.f(null==(x=i.value)?void 0:x.seats,((l,t,i)=>{var n,o,s,v;return{a:e.t(l.stuInfo?(null==(n=null==l?void 0:l.stuInfo)?void 0:n.id)!=u.value._id?"":"你":"空"),b:t,c:2==l.status?1:"",d:l.index==(null==(o=a.value)?void 0:o.index)?1:"",e:e.s((null==(s=null==l?void 0:l.stuInfo)?void 0:s.id)!=u.value._id?`background-image:url(${null==(v=l.stuInfo)?void 0:v.avatar});`:"background:#333;"),f:e.o((()=>a.value=l),t)}})),r:e.s(`--col:${null==(T=i.value)?void 0:T.col};--row:${null==(j=i.value)?void 0:j.row};`),s:e.o(m),t:n.value,v:e.p({padding:"0"}),w:a.value},a.value?e.e({x:e.p({title:"座位信息",type:"line"}),y:e.t(null==(b=a.value)?void 0:b.x),z:e.t(null==(k=a.value)?void 0:k.y),A:e.p({title:"座位"}),B:(null==(R=a.value)?void 0:R.stuInfo)&&(i.value.stuInfoVisible||1==u.value.type)},(null==(S=a.value)?void 0:S.stuInfo)&&(i.value.stuInfoVisible||1==u.value.type)?{C:e.t(null==(D=null==(C=a.value)?void 0:C.stuInfo)?void 0:D.name),D:e.p({title:"姓名"}),E:e.t(null==(N=null==(L=a.value)?void 0:L.stuInfo)?void 0:N.id),F:e.p({title:"学号"}),G:e.t(null==(W=null==(P=a.value)?void 0:P.stuInfo)?void 0:W.class),H:e.p({title:"班级"})}:{},{I:null==(B=a.value)?void 0:B.selectTime},(null==(M=a.value)?void 0:M.selectTime)?{J:e.p({date:new Date(null==(V=a.value)?void 0:V.selectTime)-3e4,format:"M月d日 h时m分",threshold:[0,36e5]}),K:e.p({title:"选择时间"})}:{},{L:e.p({padding:"0"})}):{},{M:p()},p()?{N:e.t((null==(q=null==($=a.value)?void 0:$.stuInfo)?void 0:q.id)==u.value._id?"撤销选座":3==(null==(A=a.value)?void 0:A.status)?"已被选择":"选择座位"),O:e.o(f),P:3==(null==(F=a.value)?void 0:F.status)&&(null==(E=null==(z=a.value)?void 0:z.stuInfo)?void 0:E.id)!=u.value._id||!a.value,Q:(null==(H=null==(G=a.value)?void 0:G.stuInfo)?void 0:H.id)==u.value._id?"warn":"primary",R:n.value}:{},{S:e.t(s.value?"将使用以下信息选座：":"将撤销以下选座："),T:e.p({title:"课室信息",type:"line"}),U:e.t(null==(J=i.value)?void 0:J.title),V:e.p({title:"课室"}),W:e.t(null==(K=a.value)?void 0:K.x),X:e.t(null==(O=a.value)?void 0:O.y),Y:e.p({title:"座位"}),Z:e.t(null==(Q=i.value)?void 0:Q.effectiveTimeRange.join(" 至 ")),aa:e.p({title:"生效时间"}),ab:e.p({title:"学生信息",type:"line"}),ac:e.t(u.value._id),ad:e.p({title:"学号",link:1==u.value.type}),ae:e.t(u.value.name),af:e.p({title:"姓名",link:1==u.value.type}),ag:e.t(u.value.class),ah:e.p({title:"班级",link:1==u.value.type}),ai:e.p({padding:"0"}),aj:e.o(g),ak:s.value?"primary":"warn",al:n.value,am:e.o((()=>{})),an:e.o((()=>o.value=!1)),ao:o.value?"":1})}}},a=e._export_sfc(l,[["__scopeId","data-v-1fc1e725"]]);wx.createPage(a);
