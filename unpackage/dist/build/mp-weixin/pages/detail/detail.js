"use strict";const e=require("../../common/vendor.js");if(!Array){(e.resolveComponent("uni-section")+e.resolveComponent("uni-list-item")+e.resolveComponent("uni-list")+e.resolveComponent("uni-card")+e.resolveComponent("uni-dateformat")+e.resolveComponent("uni-group"))()}Math||((()=>"../../uni_modules/uni-section/components/uni-section/uni-section.js")+(()=>"../../uni_modules/uni-list/components/uni-list-item/uni-list-item.js")+(()=>"../../uni_modules/uni-list/components/uni-list/uni-list.js")+(()=>"../../uni_modules/uni-card/components/uni-card/uni-card.js")+(()=>"../../uni_modules/uni-dateformat/components/uni-dateformat/uni-dateformat.js")+(()=>"../../uni_modules/uni-group/components/uni-group/uni-group.js"))();const l={__name:"detail",setup(l){const n=e.ref(null),t=e.ref(null),u=e.ref(),i=e.ref(!1),a=e.ref(e.index.getStorageSync("userinfo")),o=e.ref(!1),s=e.ref(!0),v=e.ref(!1);e.onLoad((async l=>{t.value=l.chartId,await d(l.chartId),v.value=!0,e.index.hideLoading()})),e.onShow((async()=>{a.value=e.index.getStorageSync("userinfo")})),e.onReady((()=>{})),e.onPullDownRefresh((async()=>{await d(t.value),e.index.stopPullDownRefresh(),e.index.showToast({title:"刷新成功",icon:"success"})}));const d=async l=>{i.value=!0;const n=e.Ws.database(),{result:t}=await n.collection("seat-chart").doc(l).get();u.value=t.data[0],e.index.setNavigationBarTitle({title:u.value.title}),i.value=!1},r=()=>{var e;if(!u.value)return!1;const l=null==(e=u.value)?void 0:e.selectableTimeRange,n=(new Date).getTime(),t=new Date(l[0]).getTime(),i=new Date(l[1]).getTime();return t<=n&&n<=i},c=async(l=!0)=>{var i;await d(t.value),l&&e.index.showToast({title:"刷新成功",icon:"success"}),n.value=u.value.seats[(null==(i=n.value)?void 0:i.index)-1]},m=async()=>{var e;a.value,s.value=(null==(e=n.value.stuInfo)?void 0:e.id)!=a.value._id,o.value=!0},p=async()=>{e.index.showLoading({title:"加载中",mask:!0});const{result:l}=await e.Ws.callFunction({name:"select-seat",data:{chartId:t.value,seatIndex:n.value.index,userinfo:a.value,isSelectSubmit:s.value,orderId:n.value.orderId}});o.value=!1,200==l.code?e.index.showToast({title:"选座成功",icon:"success"}):201==l.code?e.index.showToast({title:"撤销成功",icon:"success"}):e.index.showToast({title:l.message,icon:"error"}),c(!1)};return(l,t)=>{var v,d,f,g,w,I,x,y,h,_,T,j,b,R,S,C,D,L,P,k,M,V,W,$,q,A,B,F,N,z,E;return e.e({a:e.p({title:"课室信息",type:"line"}),b:e.t(null==(v=u.value)?void 0:v.note),c:e.p({title:"备注："}),d:e.t(null==(d=u.value)?void 0:d.selectableTimeRange.join(" 至 ")),e:e.p({title:"选座时间："}),f:e.t(null==(f=u.value)?void 0:f.effectiveTimeRange.join(" 至 ")),g:e.p({title:"生效时间："}),h:e.p({padding:"0"}),i:e.p({title:"座位表",type:"line"}),j:e.f(null==(g=u.value)?void 0:g.seats,((l,t,u)=>{var i,o,s;return{a:e.t(l.stuInfo?(null==(i=null==l?void 0:l.stuInfo)?void 0:i.id)!=a.value._id?"":"你":"空"),b:t,c:2==l.status?1:"",d:l.index==(null==(o=n.value)?void 0:o.index)?1:"",e:e.s(l.stuInfo?`background-image:url(${null==(s=l.stuInfo)?void 0:s.avatar});`:""),f:e.o((()=>n.value=l),t)}})),k:e.s(`--col:${null==(w=u.value)?void 0:w.col};--row:${null==(I=u.value)?void 0:I.row};`),l:e.o(c),m:i.value,n:e.p({padding:"0"}),o:n.value},n.value?e.e({p:e.p({title:"座位信息",type:"line"}),q:e.t(null==(x=n.value)?void 0:x.x),r:e.t(null==(y=n.value)?void 0:y.y),s:e.p({title:"座位："}),t:(null==(h=n.value)?void 0:h.stuInfo)&&(u.value.stuInfoVisible||1==a.value.type)},(null==(_=n.value)?void 0:_.stuInfo)&&(u.value.stuInfoVisible||1==a.value.type)?{v:e.t(null==(j=null==(T=n.value)?void 0:T.stuInfo)?void 0:j.name),w:e.p({title:"姓名："}),x:e.t(null==(R=null==(b=n.value)?void 0:b.stuInfo)?void 0:R.id),y:e.p({title:"学号："}),z:e.t(null==(C=null==(S=n.value)?void 0:S.stuInfo)?void 0:C.class),A:e.p({title:"班级："})}:{},{B:null==(D=n.value)?void 0:D.selectTime},(null==(L=n.value)?void 0:L.selectTime)?{C:e.p({date:new Date(null==(P=n.value)?void 0:P.selectTime)-3e4,format:"M月d日 h时m分",threshold:[0,36e5]}),D:e.p({title:"选择时间："})}:{},{E:e.p({padding:"0"})}):{},{F:r()},r()?{G:e.t((null==(M=null==(k=n.value)?void 0:k.stuInfo)?void 0:M.id)==a.value._id?"撤销选座":3==(null==(V=n.value)?void 0:V.status)?"已被选择":"选择座位"),H:e.o(m),I:3==(null==(W=n.value)?void 0:W.status)&&(null==(q=null==($=n.value)?void 0:$.stuInfo)?void 0:q.id)!=a.value._id||!n.value,J:(null==(B=null==(A=n.value)?void 0:A.stuInfo)?void 0:B.id)==a.value._id?"warn":"primary",K:i.value}:{},{L:e.t(s.value?"将使用以下信息选座：":"将撤销以下选座："),M:e.t(null==(F=u.value)?void 0:F.title),N:e.t(null==(N=n.value)?void 0:N.x),O:e.t(null==(z=n.value)?void 0:z.y),P:e.t(null==(E=u.value)?void 0:E.effectiveTimeRange.join(" 至 ")),Q:e.p({mode:"card"}),R:e.t(a.value.name),S:e.t(a.value._id),T:e.t(a.value.class),U:e.p({mode:"card"}),V:e.o(p),W:s.value?"primary":"warn",X:i.value,Y:e.o((()=>{})),Z:e.o((()=>o.value=!1)),aa:o.value?"":1})}}},n=e._export_sfc(l,[["__scopeId","data-v-8d34b318"]]);wx.createPage(n);
