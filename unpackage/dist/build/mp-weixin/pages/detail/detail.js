"use strict";const e=require("../../common/vendor.js");if(!Array){(e.resolveComponent("uni-group")+e.resolveComponent("uni-dateformat"))()}Math||((()=>"../../uni_modules/uni-group/components/uni-group/uni-group.js")+(()=>"../../uni_modules/uni-dateformat/components/uni-dateformat/uni-dateformat.js"))();const l={__name:"detail",setup(l){const a=e.ref(null),u=e.ref(null),o=e.ref(),n=e.ref(!1),t=e.ref(e.index.getStorageSync("userinfo")),i=e.ref(!1),v=e.ref(!0);e.onLoad((async e=>{u.value=e.chartId,await s(e.chartId)}));const s=async l=>{n.value=!0;const a=e.Ws.database(),{result:u}=await a.collection("seat-chart").doc(l).get();console.log(u),o.value=u.data[0],e.index.setNavigationBarTitle({title:o.value.title}),n.value=!1},d=async(l=!0)=>{await s(u.value),l&&e.index.showToast({title:"刷新成功",icon:"success"}),a.value=o.value.seats[a.value.index-1]},r=async()=>{var l;const{stuInfo:u}=t.value;if(""==u.class||""==u.id||""==u.name){const{confirm:l}=await e.index.showModal({title:"提示",content:"请先填写个人信息",confirmText:"去填写",mask:!0});if(!l)return;return e.index.navigateTo({url:"/pages/myseat/myseat"})}v.value=(null==(l=a.value.stuInfo)?void 0:l.openid)!=t.value._openid,i.value=!0},c=async()=>{e.index.showLoading({title:"加载中",mask:!0});const{result:l}=await e.Ws.callFunction({name:"select-seat",data:{chartId:u.value,seatIndex:a.value.index,userinfo:t.value,isSelectSubmit:v.value}});i.value=!1,200==l.code?e.index.showToast({title:"选座成功",icon:"success"}):201==l.code?e.index.showToast({title:"撤销成功",icon:"success"}):e.index.showToast({title:l.message,icon:"error"}),d(!1)};return(l,u)=>{var s,f,m,p,I,g,x,w,y,h,T,_,b,j,k,M,S,C,L,R,$,q,A,B,D,F,N,V,W,z,E;return e.e({a:e.t(null==(s=o.value)?void 0:s.note),b:e.t(null==(f=o.value)?void 0:f.selectableTimeRange.join(" 至 ")),c:e.t(null==(m=o.value)?void 0:m.effectiveTimeRange.join(" 至 ")),d:e.p({title:"课室信息",mode:"card"}),e:e.f(null==(p=o.value)?void 0:p.seats,((l,u,o)=>{var n,i,v;return{a:e.t(l.stuInfo?(null==(n=null==l?void 0:l.stuInfo)?void 0:n.openid)!=t.value._openid?"":"你":"空"),b:u,c:2==l.status?1:"",d:l.index==(null==(i=a.value)?void 0:i.index)?1:"",e:e.s(l.stuInfo?`background-image:url(${null==(v=l.stuInfo)?void 0:v.avatar});`:""),f:e.o((()=>a.value=l),u)}})),f:e.s(`--col:${null==(I=o.value)?void 0:I.col};--row:${null==(g=o.value)?void 0:g.row};`),g:e.o(d),h:n.value,i:e.p({title:"座位表",mode:"card"}),j:a.value},a.value?e.e({k:e.t(null==(x=a.value)?void 0:x.x),l:e.t(null==(w=a.value)?void 0:w.y),m:(null==(y=a.value)?void 0:y.stuInfo)&&(o.value.stuInfoVisible||1==t.value.type)},(null==(h=a.value)?void 0:h.stuInfo)&&(o.value.stuInfoVisible||1==t.value.type)?{n:e.t(null==(_=null==(T=a.value)?void 0:T.stuInfo)?void 0:_.name),o:e.t(null==(j=null==(b=a.value)?void 0:b.stuInfo)?void 0:j.id),p:e.t(null==(M=null==(k=a.value)?void 0:k.stuInfo)?void 0:M.class)}:{},{q:null==(S=a.value)?void 0:S.selectTime},(null==(C=a.value)?void 0:C.selectTime)?{r:e.p({date:new Date(null==(L=a.value)?void 0:L.selectTime)-3e4,format:"M月d日 h时m分",threshold:[0,36e5]})}:{},{s:e.p({title:"座位信息",mode:"card"})}):{},{t:e.t((null==($=null==(R=a.value)?void 0:R.stuInfo)?void 0:$.openid)==t.value._openid?"撤销选座":3==(null==(q=a.value)?void 0:q.status)?"已被选择":"选择座位"),v:e.o(r),w:3==(null==(A=a.value)?void 0:A.status)&&(null==(D=null==(B=a.value)?void 0:B.stuInfo)?void 0:D.openid)!=t.value._openid||!a.value,x:(null==(N=null==(F=a.value)?void 0:F.stuInfo)?void 0:N.openid)==t.value._openid?"warn":"primary",y:n.value,z:e.t(v.value?"将使用以下信息选座：":"将撤销以下选座："),A:e.t(null==(V=o.value)?void 0:V.title),B:e.t(null==(W=a.value)?void 0:W.x),C:e.t(null==(z=a.value)?void 0:z.y),D:e.t(null==(E=o.value)?void 0:E.effectiveTimeRange.join(" 至 ")),E:e.p({mode:"card"}),F:e.t(t.value.stuInfo.name),G:e.t(t.value.stuInfo.id),H:e.t(t.value.stuInfo.class),I:e.p({mode:"card"}),J:e.o(c),K:v.value?"primary":"warn",L:n.value,M:e.o((()=>{})),N:e.o((()=>i.value=!1)),O:i.value?"":1})}}},a=e._export_sfc(l,[["__scopeId","data-v-3cb2680c"]]);wx.createPage(a);
